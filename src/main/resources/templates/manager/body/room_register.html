<!doctype html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
  <head>
      <div th:replace="~{/common/fragments/head :: common-head}"></div>
      <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.0.7/dist/js/splide.min.js"></script>
      <!-- or link to the CDN -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.0.7/dist/css/splide.min.css">
  </head>
  <body>
    <!-- Navigation-->
    <div th:replace="~{/common/fragments/nav :: fragment-nav}"></div>

    <div class="text-center my-5">
        <!--
        <h1 class="fw-bolder">Welcome to Blog Home!</h1>
        <p class="lead mb-0">A Bootstrap 5 starter layout for your next blog homepage</p>
        -->
    </div>

    <!-- PageContent -->
    <div class="container px-4 px-lg-5 w-75">
        <div class="d-flex my-2 justify-content-end">
            <button class="btn btn-outline-primary" type="button">방 등록하기</button>
        </div>
        <div class="row">
            <!-- Blog entries-->
            <div class="col-lg-6">
                <!-- Featured blog post-->
                <div class="card mb-4" x-data>
                    <div class="card-header">
                        <div class="d-inline">
                            <span class="align-middle text-primary fw-bold">사진등록</span>
                        </div>
                        <label class="btn btn-sm btn-primary text-white float-end" for="input-file">
                            사진 추가
                        </label>
                        <input type="file" id="input-file" class="d-none" @change="addFile"/>
                    </div>
                    <a href="#!"><img class="card-img-top" :src="$store.fileSrc.src" width="850" height="450" /></a>
                    <div class="card-body">
                        <div id="thumbnail-carousel" class="splide">
                            <div class="splide__track">
                                <ul class="splide__list">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Side widgets-->
            <div class="col-lg-6">
                <!-- Search widget-->
                <div class="card mb-4">
                    <div class="card-header">Search</div>
                    <div class="card-body">
                        <div class="input-group">
                            <input class="form-control" type="text" placeholder="Enter search term..." aria-label="Enter search term..." aria-describedby="button-search" />
                            <button class="btn btn-primary" id="button-search" type="button">Go!</button>
                        </div>
                    </div>
                </div>
                <!-- Categories widget-->
                <div class="card mb-4">
                    <div class="card-header">Categories</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-6">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#!">Web Design</a></li>
                                    <li><a href="#!">HTML</a></li>
                                    <li><a href="#!">Freebies</a></li>
                                </ul>
                            </div>
                            <div class="col-sm-6">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#!">JavaScript</a></li>
                                    <li><a href="#!">CSS</a></li>
                                    <li><a href="#!">Tutorials</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Side widget-->
                <div class="card mb-4">
                    <div class="card-header">Side Widget</div>
                    <div class="card-body">You can put anything you want inside of these side widgets. They are easy to use, and feature the Bootstrap 5 card component!</div>
                </div>
            </div>
        </div>
    </div>

    <div class="my-5 py-2">
    </div>
    <!-- Footer-->
    <div th:replace="~{/common/fragments/footer :: common-footer}"></div>

    <script>
        const fileInfos = new Array();
        var index = 0;
        const splide = new Splide( '#thumbnail-carousel', {
                type : 'slide',
                fixedWidth : 100,
                gap        : 10,
                focus    : 'center',
          } );

        document.addEventListener( 'DOMContentLoaded', function () {
          splide.mount();
        } );

        function addFile(e) {
            if(fileInfos.length >= 10) {
                alert("파일을 10개 이상 등록할 수 없습니다.");
                return;
            }
            const [file] = e.target.files;
            let fileInfo = {file : file, key : index++};

            if(file){
                let src = URL.createObjectURL(file);
                console.log(fileInfo);
                fileInfos.push(fileInfo);
                splide.add( `<li class="splide__slide">
                                <div class="card">
                                    <div class="card-header p-0">
                                        <button type="button" class="btn-close float-end" x-on:click="removeFile(${fileInfo.key})" style="width: 0.25em; height: 0.25em;"></button>
                                    </div>
                                    <a href="#!" x-on:click="onFile(${fileInfo.key})"><img src="${src}" width="100" height="100" alt=""></a>
                                </div>
                            </li>` );
                Alpine.store('fileSrc').change(src);
            }
        }

        function removeFile(key){
            let step;
            for (step = 0; step < fileInfos.length; step++) {
                if(fileInfos[step].key == key){
                    fileInfos.splice(step, 1);
                    splide.remove(step);
                    return;
                }
            }
        }

        function onFile(key){
            let step;
            let filesSrc;
            for (step = 0; step < fileInfos.length; step++) {
                if(fileInfos[step].key == key){
                    filesSrc = URL.createObjectURL(fileInfos[step].file);
                    Alpine.store('fileSrc').change(filesSrc);
                    console.log(filesSrc);
                    return;
                }
            }
        }

        document.addEventListener('alpine:init', () => {
            Alpine.store('fileSrc', {
                src: 'https://dummyimage.com/850x650/dee2e6/6c757d.jpg',

                change(src) {
                    this.src = src
                }
            })
        })
    </script>

</body>
</html>